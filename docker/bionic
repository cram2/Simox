FROM git.h2t.iar.kit.edu:5050/sw/armarx/meta/axii:latest-bionic

# Setup environment.
SHELL ["/bin/bash", "-c"]
ENV LC_ALL C.UTF-8
ENV LANG C.UTF-8
ENV DEBIAN_FRONTEND noninteractive
ENV TZ Europe/Berlin

# Setup workspace in Docker.
RUN axii workspace create /workspace workspace
RUN axii workspace activate workspace

# Simulate activating the workspace.
ENV ARMARX_WORKSPACE=/workspace

# Setup repo in Docker.
WORKDIR $ARMARX_WORKSPACE/simox
COPY . .

# Use workspace config.
COPY docker/armarx-workspace.json $ARMARX_WORKSPACE/armarx-workspace.json

# Run the upgrade.
RUN axii workspace system --accept-apt-install
# ToDo: Prevent this from updating Simox itself.
RUN axii workspace update --prefer-https
RUN axii workspace upgrade
